<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <link rel="icon" href="%PUBLIC_URL%/favicon.ico" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <meta name="theme-color" content="#000000" />
    <meta
      name="description"
      content="Web site created using create-react-app"
    />
    <link rel="apple-touch-icon" href="%PUBLIC_URL%/logo192.png" />
    <link rel="manifest" href="%PUBLIC_URL%/manifest.json" />
    <title>Shaderplay</title>
  </head>

  <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script>

<!--
  <div id="shaders"></div>
  <script>$('#shaders').load('./shaders.html')</script>
-->

<!--
 vertexShader
-->
<script id="vertexShader" type="x-shader/x-vertex">

  attribute vec3 aPosition;
  varying highp vec2 vPosition;

  attribute vec2 aTextureCoord;
  varying highp vec2 vTextureCoord;

  varying vec2 vUv;

  void main()
  {
    vUv = uv;
    vTextureCoord = aTextureCoord;
    vPosition = aPosition.xy;

    gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );
  }
</script>

<!--
 fragmentShader_01
-->
<script id="fragmentShader_01" type="x-shader/x-fragment">
  varying vec2 vUv;
  varying highp vec2 vPosition;
  
  uniform float u_time;
  uniform vec2 u_resolution;
  uniform sampler2D u_texture;
  
  uniform vec2 u_fingers_right[21];
  uniform vec2 u_fingers_left[21];
  uniform vec2 u_hands[2];

  uniform bool u_debug;
  
  uniform float u_size;
  uniform float u_darkness;

  float random (vec2 fc) {
      return fract(sin(dot(fc.xy,
                vec2(12.9898,78.233))) *
                43758.5453123);
  }

  void main()
  {
    vec2 fc = gl_FragCoord.xy / u_resolution.xy;

    // Draw debug marks
    if(u_debug)
    {
      float markSize = 0.008;
      float dist = 0.0;
      for(int i=0; i<21; i++)
      {
        dist = distance(fc, u_fingers_right[i]);
        if(dist < markSize)
        {
          gl_FragColor = vec4(0.0, 1.0, 0.0, 1.0) / (dist * 300.0);
          return;
        }
        
        dist = distance(fc, u_fingers_left[i]);
        if(dist < markSize)
        {
          gl_FragColor = vec4(0.0, 0.0, 1.0, 1.0) / (dist * 300.0);
          return;
        }
        
        dist = distance(fc, u_hands[0]);
        if(dist < markSize)
        {
          gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) / (dist * 300.0);
          return;
        }
        
        dist = distance(fc, u_hands[1]);
        if(dist < markSize)
        {
          gl_FragColor = vec4(1.0, 0.0, 0.0, 1.0) / (dist * 300.0);
          return;
        }
      }
    }

    float noiseLevel = 0.004;
    float tempo = 200.0;
    float border = 160.0;
    float d0 = 1.0, d1 = 1.0;
    float disThresh = 0.008;
    
    if( u_hands[0] != vec2(0.0))
      d0 = distance(fc, u_hands[0]);

    if(u_hands[1] != vec2(0.0))
      d1 = distance(fc, u_hands[1]);
    
    float noise = random(fc);
    float pulse = sin(u_time * tempo * noise) * noise * 0.001;
    float dist = pow(d0 * d1, u_size) + pulse;
    
    if(dist < disThresh)
    {
      gl_FragColor = texture2D(u_texture, vUv)  * (vec4( 0.1, 1.0, 0.1, 1.0) + (dist * border));

    } else
    {
      vec4 color = vec4(vec3(dist) * u_darkness, 1.0);
      gl_FragColor = texture2D(u_texture, vUv) - color;
    }
  }
</script>

<!--
 fragmentShader_02
-->
<script id="fragmentShader_02" type="x-shader/x-fragment">
  varying vec2 vUv;
  varying highp vec2 vPosition;
  
  uniform float u_time;
  uniform vec2  u_resolution;
  uniform sampler2D u_texture;

  void main()
  {
    vec2 p = - 1.0 + 2.0 * vUv;
    float a = u_time * 40.0;
    float d, e, f, g = 1.0 / 40.0 ,h ,i ,r ,q;

    e = 400.0 * ( p.x * 0.5 + 0.5 );
    f = 400.0 * ( p.y * 0.5 + 0.5 );
    i = 200.0 + sin( e * g + a / 150.0 ) * 20.0;
    d = 200.0 + cos( f * g / 2.0 ) * 18.0 + cos( e * g ) * 7.0;
    r = sqrt( pow( abs( i - e ), 2.0 ) + pow( abs( d - f ), 2.0 ) );
    q = f / r;
    e = ( r * cos( q ) ) - a / 2.0;
    f = ( r * sin( q ) ) - a / 2.0;
    d = sin( e * g ) * 176.0 + sin( e * g ) * 164.0 + r;
    h = ( ( f + d ) + a / 2.0 ) * g;
    i = cos( h + r * p.x / 1.3 ) * ( e + e + a ) + cos( q * g * 6.0 ) * ( r + h / 3.0 );
    h = sin( f * g ) * 144.0 - sin( e * g ) * 212.0 * p.x;
    h = ( h + ( f - e ) * q + sin( r - ( a + h ) / 7.0 ) * 10.0 + i / 4.0 ) * g;
    i += cos( h * 2.3 * sin( a / 350.0 - q ) ) * 184.0 * sin( q - ( r * 4.3 + a / 12.0 ) * g ) + tan( r * g + h ) * 184.0 * cos( r * g + h );
    i = mod( i / 5.6, 256.0 ) / 64.0;
    if ( i < 0.0 ) i += 4.0;
    if ( i >= 2.0 ) i = 4.0 - i;
    d = r / 350.0;
    d += sin( d * d * 8.0 ) * 0.52;
    f = ( sin( a * g ) + 1.0 ) / 2.0;
    
    gl_FragColor = texture2D(u_texture, vUv)
                   + .5 * vec4( vec3( f * i / 1.6, i / 1.0 + d / 3.0, i ) * d * p.x + vec3( i / 1.3 + d / 8.0, i / 1.0 + d / 8.0, i ) * d * ( 1.0 - p.x ), 1.0 );
  }
</script>

  <body>
    <noscript>You need to enable JavaScript to run this app.</noscript>
    <video id="video" class="input_video" style="display:none; visibility: hidden;"></video>
    <div id="root"></div>
  </body>

</html>
